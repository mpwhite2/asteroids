
namespace SpriteKind {
    export const Smallenemy = SpriteKind.create()
    export const StatusBar1 = SpriteKind.create()
    export const Powerup = SpriteKind.create()
    export const Prox = SpriteKind.create()
}
let Ship:Sprite = null
sprites.onOverlap(SpriteKind.Player, SpriteKind.Powerup, function (sprite, otherSprite) {
    otherSprite.destroy(effects.confetti, 500)
    info.changeLifeBy(1)
})
function rotatePlayer(playerSprite: Sprite, direction: number) {
    transformSprites.changeRotation(playerSprite, direction)
}
controller.up.onEvent(ControllerButtonEvent.Pressed, function () {
    A(Ship)
})
function A(mySprite: Sprite) {
    // Zero rotation represents north; adjust to correct polar angle.
    thrustDir = transformSprites.getRotation(mySprite) - 90
    thrustDirRads = thrustDir * 3.1416 / 180
    thrustX = THRUSTER_VELOCITY * Math.cos(thrustDirRads)
    thrustY = THRUSTER_VELOCITY * Math.sin(thrustDirRads)
    mySprite.vx += thrustX
    mySprite.vy += thrustY
    mySprite.startEffect(effects.fire, 500)
}
controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    Ship.setPosition(randint(0, 160), randint(0, 120))
    transformSprites.changeRotation(Ship, randint(-360, 360))
})
sprites.onOverlap(SpriteKind.Smallenemy, SpriteKind.Prox, function (sprite, otherSprite) {
    music.sonar.play()
})
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    fireTorpedo(Ship)
})
sprites.onOverlap(SpriteKind.Enemy, SpriteKind.Prox, function (sprite, otherSprite) {
    music.sonar.play()
})
controller.left.onEvent(ControllerButtonEvent.Pressed, function () {
    rotatePlayer(Ship, -30)
})
sprites.onOverlap(SpriteKind.Player, SpriteKind.Enemy, function (sprite2, otherSprite2) {
    sprite2.startEffect(effects.ashes, 500)
    otherSprite2.destroy(effects.disintegrate, 500)
    scene.cameraShake(8, 500)
    info.changeLifeBy(-1)
    music.bigCrash.play()
    pause(1000)
})
sprites.onOverlap(SpriteKind.Projectile, SpriteKind.Smallenemy, function (sprite, otherSprite) {
    list += -50
    sprite.destroy(effects.fire, 500)
    otherSprite.destroy(effects.disintegrate, 500)
    info.changeScoreBy(1)
})
controller.right.onEvent(ControllerButtonEvent.Pressed, function () {
    rotatePlayer(Ship, 30)
})
controller.down.onEvent(ControllerButtonEvent.Pressed, function () {
    Ship.setVelocity(0, 0)
})
info.onLifeZero(function () {
    game.over(false, effects.melt)
})
sprites.onOverlap(SpriteKind.Player, SpriteKind.Food, function (sprite, otherSprite) {
    otherSprite.destroy(effects.confetti, 500)
    statusbar1.value += 50
    music.powerUp.play()
})
function fireTorpedo(playerSprite2: Sprite) {
    if (statusbar1.value > 1) {
        // 0 degrees is north; adjust to correct polar angle.
        torpedoDir = transformSprites.getRotation(playerSprite2) - 90
        torpedoDirRads = torpedoDir * (3.1416 / 180)
        torpedoVx = TORPEDO_SPEED * Math.cos(torpedoDirRads)
        torpedoVy = TORPEDO_SPEED * Math.sin(torpedoDirRads)
        // Give the torpedo a head start so the player doesn't blow up. :-)
        torpedoDx = 16 * Math.cos(torpedoDirRads)
        torpedoDy = 16 * Math.sin(torpedoDirRads)
        projectile = sprites.createProjectileFromSprite(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . 7 . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            `, playerSprite2, torpedoVx, torpedoVy)
        music.zapped.play()
        statusbar1.value += -1
    }
}
sprites.onOverlap(SpriteKind.Smallenemy, SpriteKind.Player, function (sprite, otherSprite) {
    scene.cameraShake(8, 500)
    sprite.destroy(effects.disintegrate, 500)
    otherSprite.startEffect(effects.ashes, 500)
    info.changeLifeBy(-1)
    music.bigCrash.play()
    pause(1000)
})
function Boom(mySprite2: Sprite) {
    projectile3 = sprites.createProjectileFromSprite(Small_asteroids[randint(0, Small_asteroids.length - 1)], mySprite2, randint(-50, 50), randint(-50, 50))
    projectile3.setKind(SpriteKind.Smallenemy)
    projectile4 = sprites.createProjectileFromSprite(Small_asteroids[randint(0, Small_asteroids.length - 1)], mySprite2, randint(-50, 50), randint(-50, 50))
    projectile4.setKind(SpriteKind.Smallenemy)
    projectile5 = sprites.createProjectileFromSprite(Small_asteroids[randint(0, Small_asteroids.length - 1)], mySprite2, randint(-50, 50), randint(-50, 50))
    projectile5.setKind(SpriteKind.Smallenemy)
}
sprites.onOverlap(SpriteKind.Projectile, SpriteKind.Enemy, function (sprite, otherSprite) {
    Level += -50
    Boom(otherSprite)
    sprite.destroy(effects.fire, 500)
    info.changeScoreBy(1)
    if (Math.percentChance(30)) {
        Boom(otherSprite)
    }
    otherSprite.destroy(effects.disintegrate, 500)
})
let HP: Sprite = null
let Powerup: Sprite = null
let projectile2: Sprite = null
let projectile5: Sprite = null
let projectile4: Sprite = null
let projectile3: Sprite = null
let projectile: Sprite = null
let torpedoDy = 0
let torpedoDx = 0
let torpedoVy = 0
let torpedoVx = 0
let torpedoDirRads = 0
let torpedoDir = 0
let list = 0
let thrustY = 0
let thrustX = 0
let thrustDirRads = 0
let thrustDir = 0
let TORPEDO_SPEED = 0
let THRUSTER_VELOCITY = 0
let Small_asteroids: Image[] = []
let statusbar1: StatusBarSprite = null
effects.starField.startScreenEffect()
Ship = sprites.create(img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . 7 . . . . . . . 
    . . . . . . . . 2 . . . . . . . 
    . . . . . . . 2 2 2 . . . . . . 
    . . . . . . . 2 2 2 . . . . . . 
    . . . . . . 2 2 2 2 2 . . . . . 
    . . . . . 2 2 2 2 2 2 2 . . . . 
    `, SpriteKind.Player)
statusbar1 = statusbars.create(160, 6, StatusBarKind.Energy)
statusbar1.positionDirection(CollisionDirection.Bottom)
statusbar1.setColor(7, 2)
statusbar1.value = 50
statusbar1.setPosition(80, 0)
let Prox = sprites.create(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    .............................................................22222222222222222..................................................................................
    .............................................................222222222222222222222222...........................................................................
    .............................................................22222222222222222222222222.........................................................................
    .............................................................2222222222222222222222222222.......................................................................
    ............................................................222222222222222222222222222222......................................................................
    ...........................................................22222222222222222222222222222222.....................................................................
    ...........................................................222222222222222222222222222222222....................................................................
    ..........................................................22222222222222222222222222222222222...................................................................
    .........................................................222222222222222222222222222222222222...................................................................
    .........................................................2222222222222222222222222222222222222..................................................................
    .........................................................2222222222222222222222222222222222222..................................................................
    .........................................................22222222222222222222222222222222222222.................................................................
    .........................................................22222222222222222222222222222222222222.................................................................
    .........................................................22222222222222222222222222222222222222.................................................................
    .........................................................222222222222222222222222.2222222222222.................................................................
    ..........................................................2222222222222222222222222222222222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................2222222222222222222222222222222.2222222.................................................................
    ........................................................222222222222222222222222222222222222222.................................................................
    ........................................................22222222222222222222222222222222222222..................................................................
    ........................................................22222222222222222222222222222222222222..................................................................
    ........................................................2222222222222222222222222222222222222...................................................................
    ........................................................2222222222222222222222222222222222222...................................................................
    ........................................................2222222222222222222222222222222222222...................................................................
    .........................................................222222222222222222222222222222222222...................................................................
    ..........................................................2222222222222222222..22222222222222...................................................................
    ...........................................................2222222222222222222.22222222.22222...................................................................
    ...........................................................222222222222222222222222222..........................................................................
    ..............................................................2222222222222222222222............................................................................
    ....................................................................22222222222222..............................................................................
    .....................................................................22222222222................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `, SpriteKind.Prox)
Prox.setFlag(SpriteFlag.Invisible, true)
Prox.follow(Ship)
let Big_asteroids = [
    assets.image`A`,
    assets.image`B`,
    assets.image`C`,
    assets.image`D`
]
Small_asteroids = [
    assets.image`E`,
    assets.image`F`,
    assets.image`G`,
    assets.image`H`,
    assets.image`I`,
    assets.image`J`
]
THRUSTER_VELOCITY = 5
TORPEDO_SPEED = 100
let Level = 1700
info.setLife(5)
game.onUpdateInterval(Level, function () {
    projectile2 = sprites.createProjectileFromSide(Big_asteroids[randint(0, Big_asteroids.length - 1)], randint(-50, 50), randint(-50, 50))
    projectile2.setKind(SpriteKind.Enemy)
})
forever(function () {
    if (Ship.x < 0 || Ship.x > 160) {
        if (Ship.x < 50) {
            Ship.x = 160
        } else {
            Ship.x = 0
        }
    }
    if (Ship.y < 0 || Ship.y > 120) {
        if (Ship.y < 50) {
            Ship.y = 120
        } else {
            Ship.y = 0
        }
    }
    music.playMelody("E E F - F D A C ", 120)
})
game.onUpdateInterval(10000, function () {
    if (Math.percentChance(50)) {
        Powerup = sprites.createProjectileFromSide(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . d d d d d d d d d d . . . 
            . . . d 7 7 7 7 7 7 7 7 d . . . 
            . . d 7 7 7 7 7 7 7 7 7 7 d . . 
            . . d 7 7 7 7 7 7 7 7 7 7 d . . 
            . . . d 7 7 7 7 7 7 7 7 d . . . 
            . . . d d d d d d d d d d . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            `, randint(-10, 10), randint(-10, 10))
        Powerup.setKind(SpriteKind.Food)
    } else {
        HP = sprites.createProjectileFromSide(img`
            ....................
            ....................
            ....................
            ....................
            ....................
            ......22....22......
            .....2222..2222.....
            .....2222222222.....
            .....2222222222.....
            .....2222222222.....
            ......22222222......
            .......222222.......
            .......222222.......
            ........2222........
            .........22.........
            ....................
            ....................
            ....................
            ....................
            ....................
            `, randint(-30, 30), randint(-30, 30))
        HP.setKind(SpriteKind.Powerup)
    }
})
let statusbar = 0